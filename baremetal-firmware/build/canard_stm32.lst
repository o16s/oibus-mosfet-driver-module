ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"canard_stm32.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.isFramePriorityHigher,"ax",%progbits
  18              		.align	1
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu fpv4-sp-d16
  24              	isFramePriorityHigher:
  25              	.LFB1:
  26              		.file 1 "Lib/libcanard/drivers/stm32/canard_stm32.c"
   1:Lib/libcanard/drivers/stm32/canard_stm32.c **** /*
   2:Lib/libcanard/drivers/stm32/canard_stm32.c ****  * Copyright (c) 2017 UAVCAN Team
   3:Lib/libcanard/drivers/stm32/canard_stm32.c ****  *
   4:Lib/libcanard/drivers/stm32/canard_stm32.c ****  * Distributed under the MIT License, available in the file LICENSE.
   5:Lib/libcanard/drivers/stm32/canard_stm32.c ****  *
   6:Lib/libcanard/drivers/stm32/canard_stm32.c ****  * Author: Pavel Kirienko <pavel.kirienko@zubax.com>
   7:Lib/libcanard/drivers/stm32/canard_stm32.c ****  */
   8:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
   9:Lib/libcanard/drivers/stm32/canard_stm32.c **** #include "canard_stm32.h"
  10:Lib/libcanard/drivers/stm32/canard_stm32.c **** #include "_internal_bxcan.h"
  11:Lib/libcanard/drivers/stm32/canard_stm32.c **** #include <unistd.h>
  12:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  13:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  14:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if CANARD_STM32_USE_CAN2
  15:Lib/libcanard/drivers/stm32/canard_stm32.c **** # define BXCAN                                                  CANARD_STM32_CAN2
  16:Lib/libcanard/drivers/stm32/canard_stm32.c **** #else
  17:Lib/libcanard/drivers/stm32/canard_stm32.c **** # define BXCAN                                                  CANARD_STM32_CAN1
  18:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
  19:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  20:Lib/libcanard/drivers/stm32/canard_stm32.c **** /*
  21:Lib/libcanard/drivers/stm32/canard_stm32.c ****  * State variables
  22:Lib/libcanard/drivers/stm32/canard_stm32.c ****  */
  23:Lib/libcanard/drivers/stm32/canard_stm32.c **** static CanardSTM32Stats g_stats;
  24:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  25:Lib/libcanard/drivers/stm32/canard_stm32.c **** static bool g_abort_tx_on_error = false;
  26:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  27:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  28:Lib/libcanard/drivers/stm32/canard_stm32.c **** static bool isFramePriorityHigher(uint32_t a, uint32_t b)
  29:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
  27              		.loc 1 29 0
  28              		.cfi_startproc
  29              		@ args = 0, pretend = 0, frame = 0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 2


  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              		@ link register save eliminated.
  32              	.LVL0:
  33 0000 10B4     		push	{r4}
  34              	.LCFI0:
  35              		.cfi_def_cfa_offset 4
  36              		.cfi_offset 4, -4
  37 0002 0346     		mov	r3, r0
  30:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const uint32_t clean_a = a & CANARD_CAN_EXT_ID_MASK;
  38              		.loc 1 30 0
  39 0004 20F06044 		bic	r4, r0, #-536870912
  40              	.LVL1:
  31:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const uint32_t clean_b = b & CANARD_CAN_EXT_ID_MASK;
  41              		.loc 1 31 0
  42 0008 21F06042 		bic	r2, r1, #-536870912
  43              	.LVL2:
  32:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  33:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
  34:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * STD vs EXT - if 11 most significant bits are the same, EXT loses.
  35:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
  36:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const bool ext_a = (a & CANARD_CAN_FRAME_EFF) != 0;
  37:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const bool ext_b = (b & CANARD_CAN_FRAME_EFF) != 0;
  44              		.loc 1 37 0
  45 000c C80F     		lsrs	r0, r1, #31
  46              	.LVL3:
  38:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (ext_a != ext_b)
  47              		.loc 1 38 0
  48 000e B0EBD37F 		cmp	r0, r3, lsr #31
  49 0012 10D0     		beq	.L2
  50              	.LBB2:
  39:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
  40:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const uint32_t arb11_a = ext_a ? (clean_a >> 18U) : clean_a;
  51              		.loc 1 40 0
  52 0014 002B     		cmp	r3, #0
  53 0016 0ADB     		blt	.L8
  54              	.LVL4:
  55              	.L3:
  41:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const uint32_t arb11_b = ext_b ? (clean_b >> 18U) : clean_b;
  56              		.loc 1 41 0 discriminator 4
  57 0018 0029     		cmp	r1, #0
  58 001a 0ADB     		blt	.L9
  59              	.LVL5:
  60              	.L4:
  42:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (arb11_a != arb11_b)
  61              		.loc 1 42 0 discriminator 4
  62 001c 9442     		cmp	r4, r2
  63 001e 03D0     		beq	.L5
  43:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
  44:Lib/libcanard/drivers/stm32/canard_stm32.c ****             return arb11_a < arb11_b;
  64              		.loc 1 44 0
  65 0020 9442     		cmp	r4, r2
  66 0022 2CBF     		ite	cs
  67 0024 0020     		movcs	r0, #0
  68              	.LVL6:
  69 0026 0120     		movcc	r0, #1
  70              	.LVL7:
  71              	.L5:
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 3


  72              	.LBE2:
  45:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
  46:Lib/libcanard/drivers/stm32/canard_stm32.c ****         else
  47:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
  48:Lib/libcanard/drivers/stm32/canard_stm32.c ****             return ext_b;
  49:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
  50:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
  51:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  52:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
  53:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * RTR vs Data frame - if frame identifiers and frame types are the same, RTR loses.
  54:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
  55:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const bool rtr_a = (a & CANARD_CAN_FRAME_RTR) != 0;
  56:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const bool rtr_b = (b & CANARD_CAN_FRAME_RTR) != 0;
  57:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((clean_a == clean_b) && (rtr_a != rtr_b))
  58:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
  59:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return rtr_b;
  60:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
  61:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  62:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
  63:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Plain ID arbitration - greater value loses.
  64:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
  65:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return clean_a < clean_b;
  66:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
  73              		.loc 1 66 0
  74 0028 5DF8044B 		ldr	r4, [sp], #4
  75              	.LCFI1:
  76              		.cfi_remember_state
  77              		.cfi_restore 4
  78              		.cfi_def_cfa_offset 0
  79 002c 7047     		bx	lr
  80              	.LVL8:
  81              	.L8:
  82              	.LCFI2:
  83              		.cfi_restore_state
  84              	.LBB3:
  40:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const uint32_t arb11_b = ext_b ? (clean_b >> 18U) : clean_b;
  85              		.loc 1 40 0 discriminator 1
  86 002e A40C     		lsrs	r4, r4, #18
  87              	.LVL9:
  88 0030 F2E7     		b	.L3
  89              	.LVL10:
  90              	.L9:
  41:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (arb11_a != arb11_b)
  91              		.loc 1 41 0 discriminator 1
  92 0032 920C     		lsrs	r2, r2, #18
  93              	.LVL11:
  94 0034 F2E7     		b	.L4
  95              	.LVL12:
  96              	.L2:
  97              	.LBE3:
  55:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const bool rtr_b = (b & CANARD_CAN_FRAME_RTR) != 0;
  98              		.loc 1 55 0
  99 0036 C3F38073 		ubfx	r3, r3, #30, #1
 100              	.LVL13:
  56:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((clean_a == clean_b) && (rtr_a != rtr_b))
 101              		.loc 1 56 0
 102 003a C1F38070 		ubfx	r0, r1, #30, #1
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 4


 103              	.LVL14:
  57:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 104              		.loc 1 57 0
 105 003e 9442     		cmp	r4, r2
 106 0040 04D0     		beq	.L10
 107              	.L6:
  65:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 108              		.loc 1 65 0
 109 0042 9442     		cmp	r4, r2
 110 0044 2CBF     		ite	cs
 111 0046 0020     		movcs	r0, #0
 112              	.LVL15:
 113 0048 0120     		movcc	r0, #1
 114 004a EDE7     		b	.L5
 115              	.LVL16:
 116              	.L10:
  57:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 117              		.loc 1 57 0 discriminator 1
 118 004c 8342     		cmp	r3, r0
 119 004e EBD1     		bne	.L5
 120 0050 F7E7     		b	.L6
 121              		.cfi_endproc
 122              	.LFE1:
 124              		.section	.text.convertFrameIDCanardToRegister,"ax",%progbits
 125              		.align	1
 126              		.syntax unified
 127              		.thumb
 128              		.thumb_func
 129              		.fpu fpv4-sp-d16
 131              	convertFrameIDCanardToRegister:
 132              	.LFB2:
  67:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  68:Lib/libcanard/drivers/stm32/canard_stm32.c **** /// Converts libcanard ID value into the bxCAN TX ID register format.
  69:Lib/libcanard/drivers/stm32/canard_stm32.c **** static uint32_t convertFrameIDCanardToRegister(const uint32_t id)
  70:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 133              		.loc 1 70 0
 134              		.cfi_startproc
 135              		@ args = 0, pretend = 0, frame = 0
 136              		@ frame_needed = 0, uses_anonymous_args = 0
 137              		@ link register save eliminated.
 138              	.LVL17:
  71:Lib/libcanard/drivers/stm32/canard_stm32.c ****     uint32_t out = 0;
  72:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  73:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (id & CANARD_CAN_FRAME_EFF)
 139              		.loc 1 73 0
 140 0000 021E     		subs	r2, r0, #0
 141 0002 06DB     		blt	.L15
  74:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
  75:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out = ((id & CANARD_CAN_EXT_ID_MASK) << 3U) | CANARD_STM32_CAN_TIR_IDE;
  76:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
  77:Lib/libcanard/drivers/stm32/canard_stm32.c ****     else
  78:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
  79:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out = ((id & CANARD_CAN_STD_ID_MASK) << 21U);
 142              		.loc 1 79 0
 143 0004 5005     		lsls	r0, r2, #21
 144              	.LVL18:
 145              	.L13:
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 5


  80:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
  81:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  82:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (id & CANARD_CAN_FRAME_RTR)
 146              		.loc 1 82 0
 147 0006 12F0804F 		tst	r2, #1073741824
 148 000a 01D0     		beq	.L11
  83:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
  84:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out |= CANARD_STM32_CAN_TIR_RTR;
 149              		.loc 1 84 0
 150 000c 40F00200 		orr	r0, r0, #2
 151              	.LVL19:
 152              	.L11:
  85:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
  86:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  87:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return out;
  88:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 153              		.loc 1 88 0
 154 0010 7047     		bx	lr
 155              	.LVL20:
 156              	.L15:
  75:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 157              		.loc 1 75 0
 158 0012 D300     		lsls	r3, r2, #3
 159 0014 43F00400 		orr	r0, r3, #4
 160              	.LVL21:
 161 0018 F5E7     		b	.L13
 162              		.cfi_endproc
 163              	.LFE2:
 165              		.section	.text.convertFrameIDRegisterToCanard,"ax",%progbits
 166              		.align	1
 167              		.syntax unified
 168              		.thumb
 169              		.thumb_func
 170              		.fpu fpv4-sp-d16
 172              	convertFrameIDRegisterToCanard:
 173              	.LFB3:
  89:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  90:Lib/libcanard/drivers/stm32/canard_stm32.c **** /// Converts bxCAN TX/RX (sic! both RX/TX are supported) ID register value into the libcanard ID fo
  91:Lib/libcanard/drivers/stm32/canard_stm32.c **** static uint32_t convertFrameIDRegisterToCanard(const uint32_t id)
  92:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 174              		.loc 1 92 0
 175              		.cfi_startproc
 176              		@ args = 0, pretend = 0, frame = 0
 177              		@ frame_needed = 0, uses_anonymous_args = 0
 178              		@ link register save eliminated.
 179              	.LVL22:
  93:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if (CANARD_STM32_CAN_TIR_RTR != CANARD_STM32_CAN_RIR_RTR) ||\
  94:Lib/libcanard/drivers/stm32/canard_stm32.c ****     (CANARD_STM32_CAN_TIR_IDE != CANARD_STM32_CAN_RIR_IDE)
  95:Lib/libcanard/drivers/stm32/canard_stm32.c **** # error "RIR bits do not match TIR bits, TIR --> libcanard conversion is not possible"
  96:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
  97:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
  98:Lib/libcanard/drivers/stm32/canard_stm32.c ****     uint32_t out = 0;
  99:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 100:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((id & CANARD_STM32_CAN_RIR_IDE) == 0)
 180              		.loc 1 100 0
 181 0000 10F0040F 		tst	r0, #4
 182 0004 07D1     		bne	.L17
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 6


 101:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 102:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out = (CANARD_CAN_STD_ID_MASK & (id >> 21U));
 183              		.loc 1 102 0
 184 0006 430D     		lsrs	r3, r0, #21
 185              	.LVL23:
 186              	.L18:
 103:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 104:Lib/libcanard/drivers/stm32/canard_stm32.c ****     else
 105:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 106:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out = (CANARD_CAN_EXT_ID_MASK & (id >> 3U)) | CANARD_CAN_FRAME_EFF;
 107:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 108:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 109:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((id & CANARD_STM32_CAN_RIR_RTR) != 0)
 187              		.loc 1 109 0
 188 0008 10F0020F 		tst	r0, #2
 189 000c 01D0     		beq	.L16
 110:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 111:Lib/libcanard/drivers/stm32/canard_stm32.c ****         out |= CANARD_CAN_FRAME_RTR;
 190              		.loc 1 111 0
 191 000e 43F08043 		orr	r3, r3, #1073741824
 192              	.LVL24:
 193              	.L16:
 112:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 113:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 114:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return out;
 115:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 194              		.loc 1 115 0
 195 0012 1846     		mov	r0, r3
 196              	.LVL25:
 197 0014 7047     		bx	lr
 198              	.LVL26:
 199              	.L17:
 106:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 200              		.loc 1 106 0
 201 0016 C308     		lsrs	r3, r0, #3
 202 0018 43F00043 		orr	r3, r3, #-2147483648
 203              	.LVL27:
 204 001c F4E7     		b	.L18
 205              		.cfi_endproc
 206              	.LFE3:
 208              		.section	.text.waitMSRINAKBitStateChange,"ax",%progbits
 209              		.align	1
 210              		.syntax unified
 211              		.thumb
 212              		.thumb_func
 213              		.fpu fpv4-sp-d16
 215              	waitMSRINAKBitStateChange:
 216              	.LFB4:
 116:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 117:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 118:Lib/libcanard/drivers/stm32/canard_stm32.c **** static bool waitMSRINAKBitStateChange(volatile const CanardSTM32CANType* const bxcan, const bool ta
 119:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 217              		.loc 1 119 0
 218              		.cfi_startproc
 219              		@ args = 0, pretend = 0, frame = 0
 220              		@ frame_needed = 0, uses_anonymous_args = 0
 221              		@ link register save eliminated.
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 7


 222              	.LVL28:
 223              	.LBB4:
 120:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /**
 121:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * A properly functioning bus will exhibit 11 consecutive recessive bits at the end of every co
 122:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * or while the bus is idle. The 11 consecutive recessive bits are made up of:
 123:Lib/libcanard/drivers/stm32/canard_stm32.c ****      *  1 bit - acknowledgement delimiter
 124:Lib/libcanard/drivers/stm32/canard_stm32.c ****      *  7 bit - end of frame bits
 125:Lib/libcanard/drivers/stm32/canard_stm32.c ****      *  3 bit - inter frame space
 126:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * This adds up to 11; therefore, it is not really necessary to wait longer than a few frame TX
 127:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 128:Lib/libcanard/drivers/stm32/canard_stm32.c ****     static const uint16_t TimeoutMilliseconds = 1000;
 129:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 130:Lib/libcanard/drivers/stm32/canard_stm32.c ****     for (uint16_t wait_ack = 0; wait_ack < TimeoutMilliseconds; wait_ack++)
 224              		.loc 1 130 0
 225 0000 0022     		movs	r2, #0
 226 0002 04E0     		b	.L21
 227              	.LVL29:
 228              	.L24:
 229              	.LBB5:
 230              	.LBB6:
 131:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 132:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const bool state = (bxcan->MSR & CANARD_STM32_CAN_MSR_INAK) != 0;
 133:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (state == target_state)
 134:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 135:Lib/libcanard/drivers/stm32/canard_stm32.c ****             return true;
 136:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 137:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 138:Lib/libcanard/drivers/stm32/canard_stm32.c ****         // Sleep 1 millisecond
 139:Lib/libcanard/drivers/stm32/canard_stm32.c ****         for(int i=0;i<10;i++){ int a = 9/i;}
 231              		.loc 1 139 0 discriminator 3
 232 0004 0133     		adds	r3, r3, #1
 233              	.LVL30:
 234              	.L23:
 235              		.loc 1 139 0 is_stmt 0 discriminator 1
 236 0006 092B     		cmp	r3, #9
 237 0008 FCDD     		ble	.L24
 238              	.LBE6:
 239              	.LBE5:
 130:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 240              		.loc 1 130 0 is_stmt 1 discriminator 2
 241 000a 0132     		adds	r2, r2, #1
 242              	.LVL31:
 243 000c 92B2     		uxth	r2, r2
 244              	.LVL32:
 245              	.L21:
 130:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 246              		.loc 1 130 0 is_stmt 0 discriminator 1
 247 000e B2F57A7F 		cmp	r2, #1000
 248 0012 07D2     		bcs	.L27
 249              	.LBB8:
 132:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (state == target_state)
 250              		.loc 1 132 0 is_stmt 1
 251 0014 4368     		ldr	r3, [r0, #4]
 252 0016 03F00103 		and	r3, r3, #1
 253 001a DBB2     		uxtb	r3, r3
 254              	.LVL33:
 133:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 8


 255              		.loc 1 133 0
 256 001c 8B42     		cmp	r3, r1
 257 001e 03D0     		beq	.L26
 258              	.LBB7:
 259              		.loc 1 139 0
 260 0020 0023     		movs	r3, #0
 261              	.LVL34:
 262 0022 F0E7     		b	.L23
 263              	.L27:
 264              	.LBE7:
 265              	.LBE8:
 266              	.LBE4:
 140:Lib/libcanard/drivers/stm32/canard_stm32.c ****         //usleep(1000);           // TODO: This function may be missing on some platforms
 141:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 142:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 143:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return false;
 267              		.loc 1 143 0
 268 0024 0020     		movs	r0, #0
 269              	.LVL35:
 270              	.LBB10:
 271 0026 7047     		bx	lr
 272              	.LVL36:
 273              	.L26:
 274              	.LBB9:
 135:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 275              		.loc 1 135 0
 276 0028 0120     		movs	r0, #1
 277              	.LVL37:
 278              	.LBE9:
 279              	.LBE10:
 144:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 280              		.loc 1 144 0
 281 002a 7047     		bx	lr
 282              		.cfi_endproc
 283              	.LFE4:
 285              		.section	.text.processErrorStatus,"ax",%progbits
 286              		.align	1
 287              		.syntax unified
 288              		.thumb
 289              		.thumb_func
 290              		.fpu fpv4-sp-d16
 292              	processErrorStatus:
 293              	.LFB5:
 145:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 146:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 147:Lib/libcanard/drivers/stm32/canard_stm32.c **** static void processErrorStatus(void)
 148:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 294              		.loc 1 148 0
 295              		.cfi_startproc
 296              		@ args = 0, pretend = 0, frame = 0
 297              		@ frame_needed = 0, uses_anonymous_args = 0
 298              		@ link register save eliminated.
 149:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 150:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Aborting TX transmissions if abort on error was requested
 151:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Updating error counter
 152:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 153:Lib/libcanard/drivers/stm32/canard_stm32.c ****     const uint8_t lec = (uint8_t)((BXCAN->ESR & CANARD_STM32_CAN_ESR_LEC_MASK) >> CANARD_STM32_CAN_
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 9


 299              		.loc 1 153 0
 300 0000 104B     		ldr	r3, .L35
 301 0002 9B69     		ldr	r3, [r3, #24]
 302              	.LVL38:
 154:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 155:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (lec != 0)
 303              		.loc 1 155 0
 304 0004 13F0700F 		tst	r3, #112
 305 0008 1BD0     		beq	.L32
 148:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 306              		.loc 1 148 0
 307 000a 4DF804BD 		push	{fp}
 308              	.LCFI3:
 309              		.cfi_def_cfa_offset 4
 310              		.cfi_offset 11, -4
 156:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 157:Lib/libcanard/drivers/stm32/canard_stm32.c ****         BXCAN->ESR = 0;                 // This action does only affect the LEC bits, other bits ar
 311              		.loc 1 157 0
 312 000e 0D4B     		ldr	r3, .L35
 313              	.LVL39:
 314 0010 0022     		movs	r2, #0
 315 0012 9A61     		str	r2, [r3, #24]
 158:Lib/libcanard/drivers/stm32/canard_stm32.c ****         g_stats.error_count++;
 316              		.loc 1 158 0
 317 0014 0C49     		ldr	r1, .L35+4
 318 0016 D1E902BC 		ldrd	fp, [r1, #8]
 319 001a 1BF10102 		adds	r2, fp, #1
 320 001e 4CF10003 		adc	r3, ip, #0
 321 0022 C1E90223 		strd	r2, [r1, #8]
 159:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 160:Lib/libcanard/drivers/stm32/canard_stm32.c ****         // Abort pending transmissions if auto abort on error is enabled, or if we're in bus off mo
 161:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (g_abort_tx_on_error || (BXCAN->ESR & CANARD_STM32_CAN_ESR_BOFF))
 322              		.loc 1 161 0
 323 0026 094B     		ldr	r3, .L35+8
 324 0028 1B78     		ldrb	r3, [r3]	@ zero_extendqisi2
 325 002a 23B9     		cbnz	r3, .L30
 326              		.loc 1 161 0 is_stmt 0 discriminator 1
 327 002c 054B     		ldr	r3, .L35
 328 002e 9B69     		ldr	r3, [r3, #24]
 329 0030 13F0040F 		tst	r3, #4
 330 0034 02D0     		beq	.L28
 331              	.L30:
 162:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 163:Lib/libcanard/drivers/stm32/canard_stm32.c ****             BXCAN->TSR = CANARD_STM32_CAN_TSR_ABRQ0 | CANARD_STM32_CAN_TSR_ABRQ1 | CANARD_STM32_CAN
 332              		.loc 1 163 0 is_stmt 1
 333 0036 034B     		ldr	r3, .L35
 334 0038 054A     		ldr	r2, .L35+12
 335 003a 9A60     		str	r2, [r3, #8]
 336              	.L28:
 164:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 165:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 166:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 337              		.loc 1 166 0
 338 003c 5DF804BB 		ldr	fp, [sp], #4
 339              	.LCFI4:
 340              		.cfi_restore 11
 341              		.cfi_def_cfa_offset 0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 10


 342 0040 7047     		bx	lr
 343              	.LVL40:
 344              	.L32:
 345 0042 7047     		bx	lr
 346              	.L36:
 347              		.align	2
 348              	.L35:
 349 0044 00640040 		.word	1073767424
 350 0048 00000000 		.word	.LANCHOR0
 351 004c 00000000 		.word	.LANCHOR1
 352 0050 80808000 		.word	8421504
 353              		.cfi_endproc
 354              	.LFE5:
 356              		.section	.text.canardSTM32Init,"ax",%progbits
 357              		.align	1
 358              		.global	canardSTM32Init
 359              		.syntax unified
 360              		.thumb
 361              		.thumb_func
 362              		.fpu fpv4-sp-d16
 364              	canardSTM32Init:
 365              	.LFB6:
 167:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 168:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 169:Lib/libcanard/drivers/stm32/canard_stm32.c **** int16_t canardSTM32Init(const CanardSTM32CANTimings* const timings,
 170:Lib/libcanard/drivers/stm32/canard_stm32.c ****                         const CanardSTM32IfaceMode iface_mode)
 171:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 366              		.loc 1 171 0
 367              		.cfi_startproc
 368              		@ args = 0, pretend = 0, frame = 0
 369              		@ frame_needed = 0, uses_anonymous_args = 0
 370              	.LVL41:
 172:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 173:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Paranoia time.
 174:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 175:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((iface_mode != CanardSTM32IfaceModeNormal) &&
 371              		.loc 1 175 0
 372 0000 0229     		cmp	r1, #2
 373 0002 00F2B380 		bhi	.L44
 176:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (iface_mode != CanardSTM32IfaceModeSilent) &&
 177:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (iface_mode != CanardSTM32IfaceModeAutomaticTxAbortOnError))
 178:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 179:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_ERROR_INVALID_ARGUMENT;
 180:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 181:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 182:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((timings == NULL) ||
 374              		.loc 1 182 0
 375 0006 0028     		cmp	r0, #0
 376 0008 00F0B380 		beq	.L45
 171:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 377              		.loc 1 171 0 discriminator 1
 378 000c 38B5     		push	{r3, r4, r5, lr}
 379              	.LCFI5:
 380              		.cfi_def_cfa_offset 16
 381              		.cfi_offset 3, -16
 382              		.cfi_offset 4, -12
 383              		.cfi_offset 5, -8
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 11


 384              		.cfi_offset 14, -4
 183:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_rate_prescaler < 1) || (timings->bit_rate_prescaler > 1024) ||
 385              		.loc 1 183 0 discriminator 1
 386 000e 0388     		ldrh	r3, [r0]
 182:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_rate_prescaler < 1) || (timings->bit_rate_prescaler > 1024) ||
 387              		.loc 1 182 0 discriminator 1
 388 0010 002B     		cmp	r3, #0
 389 0012 00F0B180 		beq	.L46
 390              		.loc 1 183 0
 391 0016 B3F5806F 		cmp	r3, #1024
 392 001a 00F2B080 		bhi	.L47
 184:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->max_resynchronization_jump_width < 1) || (timings->max_resynchronization_jump_wid
 393              		.loc 1 184 0 discriminator 1
 394 001e 0379     		ldrb	r3, [r0, #4]	@ zero_extendqisi2
 183:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_rate_prescaler < 1) || (timings->bit_rate_prescaler > 1024) ||
 395              		.loc 1 183 0 discriminator 1
 396 0020 002B     		cmp	r3, #0
 397 0022 00F0AF80 		beq	.L48
 398              		.loc 1 184 0
 399 0026 042B     		cmp	r3, #4
 400 0028 00F2AF80 		bhi	.L49
 185:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_segment_1 < 1) || (timings->bit_segment_1 > 16) ||
 401              		.loc 1 185 0 discriminator 1
 402 002c 8378     		ldrb	r3, [r0, #2]	@ zero_extendqisi2
 184:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->max_resynchronization_jump_width < 1) || (timings->max_resynchronization_jump_wid
 403              		.loc 1 184 0 discriminator 1
 404 002e 002B     		cmp	r3, #0
 405 0030 00F0AE80 		beq	.L50
 406              		.loc 1 185 0
 407 0034 102B     		cmp	r3, #16
 408 0036 00F2AE80 		bhi	.L51
 186:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_segment_2 < 1) || (timings->bit_segment_2 > 8))
 409              		.loc 1 186 0 discriminator 1
 410 003a C378     		ldrb	r3, [r0, #3]	@ zero_extendqisi2
 185:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (timings->bit_segment_1 < 1) || (timings->bit_segment_1 > 16) ||
 411              		.loc 1 185 0 discriminator 1
 412 003c 002B     		cmp	r3, #0
 413 003e 00F0AD80 		beq	.L52
 414              		.loc 1 186 0
 415 0042 082B     		cmp	r3, #8
 416 0044 00F2AD80 		bhi	.L53
 417 0048 0C46     		mov	r4, r1
 418 004a 0546     		mov	r5, r0
 187:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 188:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_ERROR_INVALID_ARGUMENT;
 189:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 190:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 191:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 192:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Initial setup
 193:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 194:Lib/libcanard/drivers/stm32/canard_stm32.c ****     memset(&g_stats, 0, sizeof(g_stats));
 419              		.loc 1 194 0
 420 004c 564A     		ldr	r2, .L64
 421 004e 0023     		movs	r3, #0
 422 0050 1360     		str	r3, [r2]
 423 0052 5360     		str	r3, [r2, #4]
 424 0054 9360     		str	r3, [r2, #8]
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 12


 425 0056 D360     		str	r3, [r2, #12]
 195:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 196:Lib/libcanard/drivers/stm32/canard_stm32.c ****     g_abort_tx_on_error = (iface_mode == CanardSTM32IfaceModeAutomaticTxAbortOnError);
 426              		.loc 1 196 0
 427 0058 0229     		cmp	r1, #2
 428 005a 14BF     		ite	ne
 429 005c 0021     		movne	r1, #0
 430              	.LVL42:
 431 005e 0121     		moveq	r1, #1
 432 0060 524A     		ldr	r2, .L64+4
 433 0062 1170     		strb	r1, [r2]
 197:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 198:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if CANARD_STM32_USE_CAN2
 199:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // If we're using CAN2, we MUST initialize CAN1 first, because CAN2 is a slave to CAN1.
 200:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->IER = 0;                                 // We need no interrupts
 201:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->MCR &= ~CANARD_STM32_CAN_MCR_SLEEP;      // Exit sleep mode
 202:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->MCR |= CANARD_STM32_CAN_MCR_INRQ;        // Request init
 203:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 204:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (!waitMSRINAKBitStateChange(CANARD_STM32_CAN1, true))    // Wait for synchronization
 205:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 206:Lib/libcanard/drivers/stm32/canard_stm32.c ****         CANARD_STM32_CAN1->MCR = CANARD_STM32_CAN_MCR_RESET;
 207:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_MSR_INAK_NOT_SET;
 208:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 209:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // CAN1 will be left in the initialization mode forever, in this mode it does not affect the bu
 210:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
 211:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 212:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->IER = 0;                                             // We need no interrupts
 434              		.loc 1 212 0
 435 0064 5248     		ldr	r0, .L64+8
 436              	.LVL43:
 437 0066 4361     		str	r3, [r0, #20]
 213:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->MCR &= ~CANARD_STM32_CAN_MCR_SLEEP;                  // Exit sleep mode
 438              		.loc 1 213 0
 439 0068 0368     		ldr	r3, [r0]
 440 006a 23F00203 		bic	r3, r3, #2
 441 006e 0360     		str	r3, [r0]
 214:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->MCR |= CANARD_STM32_CAN_MCR_INRQ;                    // Request init
 442              		.loc 1 214 0
 443 0070 0368     		ldr	r3, [r0]
 444 0072 43F00103 		orr	r3, r3, #1
 445 0076 0360     		str	r3, [r0]
 215:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 216:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (!waitMSRINAKBitStateChange(BXCAN, true))                // Wait for synchronization
 446              		.loc 1 216 0
 447 0078 0121     		movs	r1, #1
 448 007a FFF7FEFF 		bl	waitMSRINAKBitStateChange
 449              	.LVL44:
 450 007e 0028     		cmp	r0, #0
 451 0080 57D0     		beq	.L59
 217:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 218:Lib/libcanard/drivers/stm32/canard_stm32.c ****         BXCAN->MCR = CANARD_STM32_CAN_MCR_RESET;
 219:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_MSR_INAK_NOT_SET;
 220:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 221:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 222:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 223:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Hardware initialization (the hardware has already confirmed initialization mode, see above)
 224:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 13


 225:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->MCR = CANARD_STM32_CAN_MCR_ABOM | CANARD_STM32_CAN_MCR_AWUM | CANARD_STM32_CAN_MCR_INRQ;
 452              		.loc 1 225 0
 453 0082 4B4B     		ldr	r3, .L64+8
 454 0084 6122     		movs	r2, #97
 455 0086 1A60     		str	r2, [r3]
 226:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 227:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->BTR = (((timings->max_resynchronization_jump_width - 1U) &    3U) << 24U) |
 456              		.loc 1 227 0
 457 0088 2B79     		ldrb	r3, [r5, #4]	@ zero_extendqisi2
 458 008a 013B     		subs	r3, r3, #1
 459 008c 1B06     		lsls	r3, r3, #24
 460 008e 03F04073 		and	r3, r3, #50331648
 228:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_1 - 1U)                    &   15U) << 16U) |
 461              		.loc 1 228 0
 462 0092 AA78     		ldrb	r2, [r5, #2]	@ zero_extendqisi2
 463 0094 013A     		subs	r2, r2, #1
 464 0096 1204     		lsls	r2, r2, #16
 465 0098 02F47022 		and	r2, r2, #983040
 227:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_1 - 1U)                    &   15U) << 16U) |
 466              		.loc 1 227 0
 467 009c 1343     		orrs	r3, r3, r2
 229:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_2 - 1U)                    &    7U) << 20U) |
 468              		.loc 1 229 0
 469 009e EA78     		ldrb	r2, [r5, #3]	@ zero_extendqisi2
 470 00a0 013A     		subs	r2, r2, #1
 471 00a2 1205     		lsls	r2, r2, #20
 472 00a4 02F4E002 		and	r2, r2, #7340032
 228:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_1 - 1U)                    &   15U) << 16U) |
 473              		.loc 1 228 0
 474 00a8 1343     		orrs	r3, r3, r2
 230:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  ((timings->bit_rate_prescaler - 1U)                & 1023U) |
 475              		.loc 1 230 0
 476 00aa 2A88     		ldrh	r2, [r5]
 477 00ac 013A     		subs	r2, r2, #1
 478 00ae C2F30902 		ubfx	r2, r2, #0, #10
 229:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_2 - 1U)                    &    7U) << 20U) |
 479              		.loc 1 229 0
 480 00b2 1343     		orrs	r3, r3, r2
 231:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  ((iface_mode == CanardSTM32IfaceModeSilent) ? CANARD_STM32_CAN_BTR_SILM : 0);
 481              		.loc 1 231 0
 482 00b4 012C     		cmp	r4, #1
 483 00b6 43D0     		beq	.L60
 484 00b8 0022     		movs	r2, #0
 485              	.L40:
 230:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  ((timings->bit_rate_prescaler - 1U)                & 1023U) |
 486              		.loc 1 230 0
 487 00ba 1343     		orrs	r3, r3, r2
 227:Lib/libcanard/drivers/stm32/canard_stm32.c ****                  (((timings->bit_segment_1 - 1U)                    &   15U) << 16U) |
 488              		.loc 1 227 0
 489 00bc 3C4A     		ldr	r2, .L64+8
 490 00be D361     		str	r3, [r2, #28]
 232:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 233:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_ASSERT(0 == BXCAN->IER);             // Making sure the iterrupts are indeed disabled
 491              		.loc 1 233 0
 492 00c0 5369     		ldr	r3, [r2, #20]
 493 00c2 002B     		cmp	r3, #0
 494 00c4 3FD1     		bne	.L61
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 14


 234:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 235:Lib/libcanard/drivers/stm32/canard_stm32.c ****     BXCAN->MCR &= ~CANARD_STM32_CAN_MCR_INRQ;   // Leave init mode
 495              		.loc 1 235 0
 496 00c6 3A48     		ldr	r0, .L64+8
 497 00c8 0368     		ldr	r3, [r0]
 498 00ca 23F00103 		bic	r3, r3, #1
 499 00ce 0360     		str	r3, [r0]
 236:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 237:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (!waitMSRINAKBitStateChange(BXCAN, false))
 500              		.loc 1 237 0
 501 00d0 0021     		movs	r1, #0
 502 00d2 FFF7FEFF 		bl	waitMSRINAKBitStateChange
 503              	.LVL45:
 504 00d6 0028     		cmp	r0, #0
 505 00d8 3BD0     		beq	.L62
 506              	.LBB11:
 238:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 239:Lib/libcanard/drivers/stm32/canard_stm32.c ****         BXCAN->MCR = CANARD_STM32_CAN_MCR_RESET;
 240:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_MSR_INAK_NOT_CLEARED;
 241:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 242:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 243:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 244:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Default filter configuration. Note that ALL filters are available ONLY via CAN1!
 245:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * CAN2 filters are offset by 14.
 246:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * We use 14 filters at most always which simplifies the code and ensures compatibility with al
 247:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * MCU within the STM32 family.
 248:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 249:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 250:Lib/libcanard/drivers/stm32/canard_stm32.c ****         uint32_t fmr = CANARD_STM32_CAN1->FMR & 0xFFFFC0F1U;
 507              		.loc 1 250 0
 508 00da 354A     		ldr	r2, .L64+8
 509 00dc D2F80032 		ldr	r3, [r2, #512]
 510 00e0 23F47C53 		bic	r3, r3, #16128
 511 00e4 23F00E03 		bic	r3, r3, #14
 512              	.LVL46:
 251:Lib/libcanard/drivers/stm32/canard_stm32.c ****         fmr |= CANARD_STM32_NUM_ACCEPTANCE_FILTERS << 8U;                // CAN2 start bank = 14 (i
 252:Lib/libcanard/drivers/stm32/canard_stm32.c ****         CANARD_STM32_CAN1->FMR = fmr | CANARD_STM32_CAN_FMR_FINIT;
 513              		.loc 1 252 0
 514 00e8 43F46063 		orr	r3, r3, #3584
 515              	.LVL47:
 516 00ec 43F00103 		orr	r3, r3, #1
 517              	.LVL48:
 518 00f0 C2F80032 		str	r3, [r2, #512]
 519              	.LBE11:
 253:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 254:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 255:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_ASSERT(((CANARD_STM32_CAN1->FMR >> 8U) & 0x3FU) == CANARD_STM32_NUM_ACCEPTANCE_FILTERS);
 520              		.loc 1 255 0
 521 00f4 D2F80032 		ldr	r3, [r2, #512]
 522 00f8 C3F30523 		ubfx	r3, r3, #8, #6
 523 00fc 0E2B     		cmp	r3, #14
 524 00fe 2FD1     		bne	.L63
 256:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 257:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FM1R = 0;                                        // Indentifier Mask mode
 525              		.loc 1 257 0
 526 0100 2B4B     		ldr	r3, .L64+8
 527 0102 0020     		movs	r0, #0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 15


 528 0104 C3F80402 		str	r0, [r3, #516]
 258:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FS1R = 0x0FFFFFFF;                               // All 32-bit
 529              		.loc 1 258 0
 530 0108 6FF07042 		mvn	r2, #-268435456
 531 010c C3F80C22 		str	r2, [r3, #524]
 259:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 260:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // Filters are alternating between FIFO0 and FIFO1 in order to equalize the load.
 261:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // This will cause occasional priority inversion and frame reordering on reception,
 262:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // but that is acceptable for UAVCAN, and a majority of other protocols will tolerate
 263:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // this too, since there will be no reordering within the same CAN ID.
 264:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FFA1R = 0x0AAAAAAA;
 532              		.loc 1 264 0
 533 0110 284A     		ldr	r2, .L64+12
 534 0112 C3F81422 		str	r2, [r3, #532]
 265:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 266:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if CANARD_STM32_USE_CAN2
 267:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FilterRegister[CANARD_STM32_NUM_ACCEPTANCE_FILTERS].FR1 = 0;
 268:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FilterRegister[CANARD_STM32_NUM_ACCEPTANCE_FILTERS].FR2 = 0;
 269:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FA1R = (1 << CANARD_STM32_NUM_ACCEPTANCE_FILTERS);  // One filter enabled
 270:Lib/libcanard/drivers/stm32/canard_stm32.c **** #else
 271:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FilterRegister[0].FR1 = 0;
 535              		.loc 1 271 0
 536 0116 C3F84002 		str	r0, [r3, #576]
 272:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FilterRegister[0].FR2 = 0;
 537              		.loc 1 272 0
 538 011a C3F84402 		str	r0, [r3, #580]
 273:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FA1R = 1;                                        // One filter enabled
 539              		.loc 1 273 0
 540 011e 0122     		movs	r2, #1
 541 0120 C3F81C22 		str	r2, [r3, #540]
 274:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
 275:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 276:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FMR &= ~CANARD_STM32_CAN_FMR_FINIT;              // Leave initialization mod
 542              		.loc 1 276 0
 543 0124 D3F80022 		ldr	r2, [r3, #512]
 544 0128 22F00102 		bic	r2, r2, #1
 545 012c C3F80022 		str	r2, [r3, #512]
 546              	.LVL49:
 547              	.L38:
 277:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 278:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return 0;
 279:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 548              		.loc 1 279 0
 549 0130 38BD     		pop	{r3, r4, r5, pc}
 550              	.LVL50:
 551              	.L59:
 218:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_MSR_INAK_NOT_SET;
 552              		.loc 1 218 0
 553 0132 1F4B     		ldr	r3, .L64+8
 554 0134 4FF40042 		mov	r2, #32768
 555 0138 1A60     		str	r2, [r3]
 219:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 556              		.loc 1 219 0
 557 013a 6FF47A70 		mvn	r0, #1000
 558 013e F7E7     		b	.L38
 559              	.L60:
 231:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 16


 560              		.loc 1 231 0
 561 0140 4FF00042 		mov	r2, #-2147483648
 562 0144 B9E7     		b	.L40
 563              	.L61:
 233:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 564              		.loc 1 233 0 discriminator 1
 565 0146 1C4B     		ldr	r3, .L64+16
 566 0148 1C4A     		ldr	r2, .L64+20
 567 014a E921     		movs	r1, #233
 568 014c 1C48     		ldr	r0, .L64+24
 569 014e FFF7FEFF 		bl	__assert_func
 570              	.LVL51:
 571              	.L62:
 239:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_MSR_INAK_NOT_CLEARED;
 572              		.loc 1 239 0
 573 0152 174B     		ldr	r3, .L64+8
 574 0154 4FF40042 		mov	r2, #32768
 575 0158 1A60     		str	r2, [r3]
 240:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 576              		.loc 1 240 0
 577 015a A0F2EA30 		subw	r0, r0, #1002
 578 015e E7E7     		b	.L38
 579              	.L63:
 255:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 580              		.loc 1 255 0 discriminator 1
 581 0160 184B     		ldr	r3, .L64+28
 582 0162 164A     		ldr	r2, .L64+20
 583 0164 FF21     		movs	r1, #255
 584 0166 1648     		ldr	r0, .L64+24
 585 0168 FFF7FEFF 		bl	__assert_func
 586              	.LVL52:
 587              	.L44:
 588              	.LCFI6:
 589              		.cfi_def_cfa_offset 0
 590              		.cfi_restore 3
 591              		.cfi_restore 4
 592              		.cfi_restore 5
 593              		.cfi_restore 14
 179:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 594              		.loc 1 179 0
 595 016c 6FF00100 		mvn	r0, #1
 596              	.LVL53:
 597 0170 7047     		bx	lr
 598              	.LVL54:
 599              	.L45:
 188:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 600              		.loc 1 188 0
 601 0172 6FF00100 		mvn	r0, #1
 602              	.LVL55:
 603              		.loc 1 279 0
 604 0176 7047     		bx	lr
 605              	.LVL56:
 606              	.L46:
 607              	.LCFI7:
 608              		.cfi_def_cfa_offset 16
 609              		.cfi_offset 3, -16
 610              		.cfi_offset 4, -12
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 17


 611              		.cfi_offset 5, -8
 612              		.cfi_offset 14, -4
 188:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 613              		.loc 1 188 0
 614 0178 6FF00100 		mvn	r0, #1
 615              	.LVL57:
 616 017c D8E7     		b	.L38
 617              	.LVL58:
 618              	.L47:
 619 017e 6FF00100 		mvn	r0, #1
 620              	.LVL59:
 621 0182 D5E7     		b	.L38
 622              	.LVL60:
 623              	.L48:
 624 0184 6FF00100 		mvn	r0, #1
 625              	.LVL61:
 626 0188 D2E7     		b	.L38
 627              	.LVL62:
 628              	.L49:
 629 018a 6FF00100 		mvn	r0, #1
 630              	.LVL63:
 631 018e CFE7     		b	.L38
 632              	.LVL64:
 633              	.L50:
 634 0190 6FF00100 		mvn	r0, #1
 635              	.LVL65:
 636 0194 CCE7     		b	.L38
 637              	.LVL66:
 638              	.L51:
 639 0196 6FF00100 		mvn	r0, #1
 640              	.LVL67:
 641 019a C9E7     		b	.L38
 642              	.LVL68:
 643              	.L52:
 644 019c 6FF00100 		mvn	r0, #1
 645              	.LVL69:
 646 01a0 C6E7     		b	.L38
 647              	.LVL70:
 648              	.L53:
 649 01a2 6FF00100 		mvn	r0, #1
 650              	.LVL71:
 651 01a6 C3E7     		b	.L38
 652              	.L65:
 653              		.align	2
 654              	.L64:
 655 01a8 00000000 		.word	.LANCHOR0
 656 01ac 00000000 		.word	.LANCHOR1
 657 01b0 00640040 		.word	1073767424
 658 01b4 AAAAAA0A 		.word	178956970
 659 01b8 00000000 		.word	.LC0
 660 01bc 00000000 		.word	.LANCHOR2
 661 01c0 38000000 		.word	.LC1
 662 01c4 64000000 		.word	.LC2
 663              		.cfi_endproc
 664              	.LFE6:
 666              		.section	.text.canardSTM32Transmit,"ax",%progbits
 667              		.align	1
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 18


 668              		.global	canardSTM32Transmit
 669              		.syntax unified
 670              		.thumb
 671              		.thumb_func
 672              		.fpu fpv4-sp-d16
 674              	canardSTM32Transmit:
 675              	.LFB7:
 280:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 281:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 282:Lib/libcanard/drivers/stm32/canard_stm32.c **** int16_t canardSTM32Transmit(const CanardCANFrame* const frame)
 283:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 676              		.loc 1 283 0
 677              		.cfi_startproc
 678              		@ args = 0, pretend = 0, frame = 8
 679              		@ frame_needed = 0, uses_anonymous_args = 0
 680              	.LVL72:
 284:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (frame == NULL)
 681              		.loc 1 284 0
 682 0000 0028     		cmp	r0, #0
 683 0002 75D0     		beq	.L73
 283:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (frame == NULL)
 684              		.loc 1 283 0
 685 0004 70B5     		push	{r4, r5, r6, lr}
 686              	.LCFI8:
 687              		.cfi_def_cfa_offset 16
 688              		.cfi_offset 4, -16
 689              		.cfi_offset 5, -12
 690              		.cfi_offset 6, -8
 691              		.cfi_offset 14, -4
 692 0006 82B0     		sub	sp, sp, #8
 693              	.LCFI9:
 694              		.cfi_def_cfa_offset 24
 695 0008 0446     		mov	r4, r0
 285:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 286:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_ERROR_INVALID_ARGUMENT;
 287:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 288:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 289:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (frame->id & CANARD_CAN_FRAME_ERR)
 696              		.loc 1 289 0
 697 000a 0368     		ldr	r3, [r0]
 698 000c 13F0005F 		tst	r3, #536870912
 699 0010 71D1     		bne	.L74
 290:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 291:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_STM32_ERROR_UNSUPPORTED_FRAME_FORMAT;
 292:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 293:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 294:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 295:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Handling error status might free up some slots through aborts
 296:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 297:Lib/libcanard/drivers/stm32/canard_stm32.c ****     processErrorStatus();
 700              		.loc 1 297 0
 701 0012 FFF7FEFF 		bl	processErrorStatus
 702              	.LVL73:
 298:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 299:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 300:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Seeking an empty slot, checking if priority inversion would occur if we enqueued now.
 301:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * We can always enqueue safely if all TX mailboxes are free and no transmissions are pending.
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 19


 302:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 303:Lib/libcanard/drivers/stm32/canard_stm32.c ****     uint8_t tx_mailbox = 0xFF;
 304:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 305:Lib/libcanard/drivers/stm32/canard_stm32.c ****     static const uint32_t AllTME = CANARD_STM32_CAN_TSR_TME0 | CANARD_STM32_CAN_TSR_TME1 | CANARD_S
 306:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 307:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((BXCAN->TSR & AllTME) != AllTME)                // At least one TX mailbox is used, detaile
 703              		.loc 1 307 0
 704 0016 394B     		ldr	r3, .L84
 705 0018 9B68     		ldr	r3, [r3, #8]
 706 001a 03F0E053 		and	r3, r3, #469762048
 707 001e B3F1E05F 		cmp	r3, #469762048
 708 0022 63D0     		beq	.L75
 709              	.LBB12:
 308:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 309:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const bool tme[3] =
 310:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 311:Lib/libcanard/drivers/stm32/canard_stm32.c ****             (BXCAN->TSR & CANARD_STM32_CAN_TSR_TME0) != 0,
 710              		.loc 1 311 0
 711 0024 354B     		ldr	r3, .L84
 712 0026 9A68     		ldr	r2, [r3, #8]
 713 0028 C2F38062 		ubfx	r2, r2, #26, #1
 309:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 714              		.loc 1 309 0
 715 002c 8DF80420 		strb	r2, [sp, #4]
 312:Lib/libcanard/drivers/stm32/canard_stm32.c ****             (BXCAN->TSR & CANARD_STM32_CAN_TSR_TME1) != 0,
 716              		.loc 1 312 0
 717 0030 9A68     		ldr	r2, [r3, #8]
 718 0032 C2F3C062 		ubfx	r2, r2, #27, #1
 309:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 719              		.loc 1 309 0
 720 0036 8DF80520 		strb	r2, [sp, #5]
 313:Lib/libcanard/drivers/stm32/canard_stm32.c ****             (BXCAN->TSR & CANARD_STM32_CAN_TSR_TME2) != 0
 721              		.loc 1 313 0
 722 003a 9B68     		ldr	r3, [r3, #8]
 723 003c C3F30073 		ubfx	r3, r3, #28, #1
 309:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 724              		.loc 1 309 0
 725 0040 8DF80630 		strb	r3, [sp, #6]
 726              	.LVL74:
 727              	.LBB13:
 314:Lib/libcanard/drivers/stm32/canard_stm32.c ****         };
 315:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 316:Lib/libcanard/drivers/stm32/canard_stm32.c ****         for (uint8_t i = 0; i < 3; i++)
 728              		.loc 1 316 0
 729 0044 0025     		movs	r5, #0
 730              	.LBE13:
 731              	.LBE12:
 303:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 732              		.loc 1 303 0
 733 0046 FF26     		movs	r6, #255
 734              	.LBB15:
 735              	.LBB14:
 736              		.loc 1 316 0
 737 0048 02E0     		b	.L69
 738              	.LVL75:
 739              	.L76:
 317:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 20


 318:Lib/libcanard/drivers/stm32/canard_stm32.c ****             if (tme[i])                                 // This TX mailbox is free, we can use it
 319:Lib/libcanard/drivers/stm32/canard_stm32.c ****             {
 320:Lib/libcanard/drivers/stm32/canard_stm32.c ****                 tx_mailbox = i;
 740              		.loc 1 320 0
 741 004a 2E46     		mov	r6, r5
 742              	.LVL76:
 743              	.L70:
 316:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 744              		.loc 1 316 0 discriminator 2
 745 004c 0135     		adds	r5, r5, #1
 746              	.LVL77:
 747 004e EDB2     		uxtb	r5, r5
 748              	.LVL78:
 749              	.L69:
 316:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 750              		.loc 1 316 0 is_stmt 0 discriminator 1
 751 0050 022D     		cmp	r5, #2
 752 0052 13D8     		bhi	.L81
 318:Lib/libcanard/drivers/stm32/canard_stm32.c ****             {
 753              		.loc 1 318 0 is_stmt 1
 754 0054 02AB     		add	r3, sp, #8
 755 0056 2B44     		add	r3, r3, r5
 756 0058 13F8043C 		ldrb	r3, [r3, #-4]	@ zero_extendqisi2
 757 005c 002B     		cmp	r3, #0
 758 005e F4D1     		bne	.L76
 321:Lib/libcanard/drivers/stm32/canard_stm32.c ****             }
 322:Lib/libcanard/drivers/stm32/canard_stm32.c ****             else                                        // This TX mailbox is pending, check for pr
 323:Lib/libcanard/drivers/stm32/canard_stm32.c ****             {
 324:Lib/libcanard/drivers/stm32/canard_stm32.c ****                 if (!isFramePriorityHigher(frame->id, convertFrameIDRegisterToCanard(BXCAN->TxMailb
 759              		.loc 1 324 0
 760 0060 05F11803 		add	r3, r5, #24
 761 0064 1B01     		lsls	r3, r3, #4
 762 0066 254A     		ldr	r2, .L84
 763 0068 D058     		ldr	r0, [r2, r3]
 764 006a FFF7FEFF 		bl	convertFrameIDRegisterToCanard
 765              	.LVL79:
 766 006e 0146     		mov	r1, r0
 767 0070 2068     		ldr	r0, [r4]
 768 0072 FFF7FEFF 		bl	isFramePriorityHigher
 769              	.LVL80:
 770 0076 0028     		cmp	r0, #0
 771 0078 E8D1     		bne	.L70
 772 007a 27E0     		b	.L67
 773              	.L81:
 774              	.LBE14:
 325:Lib/libcanard/drivers/stm32/canard_stm32.c ****                 {
 326:Lib/libcanard/drivers/stm32/canard_stm32.c ****                     // There's a mailbox whose priority is higher or equal the priority of the new 
 327:Lib/libcanard/drivers/stm32/canard_stm32.c ****                     return 0;                           // Priority inversion would occur! Reject t
 328:Lib/libcanard/drivers/stm32/canard_stm32.c ****                 }
 329:Lib/libcanard/drivers/stm32/canard_stm32.c ****             }
 330:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 331:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 332:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (tx_mailbox == 0xFF)
 775              		.loc 1 332 0
 776 007c FF2E     		cmp	r6, #255
 777 007e 27D0     		beq	.L82
 778              	.LBE15:
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 21


 333:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 334:Lib/libcanard/drivers/stm32/canard_stm32.c ****             /*
 335:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * All TX mailboxes are busy (this is highly unlikely); at the same time we know that t
 336:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * higher or equal priority frame that is currently pending. Therefore, priority invers
 337:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * just happend (sic!), because we can't enqueue the higher priority frame due to all T
 338:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * being busy. This scenario is extremely unlikely, because in order for it to happen, 
 339:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * would need to transmit 4 (four) or more CAN frames with different CAN ID ordered fro
 340:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * low ID nearly at the same time. For example:
 341:Lib/libcanard/drivers/stm32/canard_stm32.c ****              *  1. 0x123        <-- Takes mailbox 0 (or any other)
 342:Lib/libcanard/drivers/stm32/canard_stm32.c ****              *  2. 0x122        <-- Takes mailbox 2 (or any other)
 343:Lib/libcanard/drivers/stm32/canard_stm32.c ****              *  3. 0x121        <-- Takes mailbox 1 (or any other)
 344:Lib/libcanard/drivers/stm32/canard_stm32.c ****              *  4. 0x120        <-- INNER PRIORITY INVERSION HERE (only if all three TX mailboxes a
 345:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * This situation is even less likely to cause any noticeable disruptions on the CAN bu
 346:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * it is better to warn the developer about that during debugging, so we fire an assert
 347:Lib/libcanard/drivers/stm32/canard_stm32.c ****              * It is perfectly safe to remove it.
 348:Lib/libcanard/drivers/stm32/canard_stm32.c ****              */
 349:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if CANARD_STM32_DEBUG_INNER_PRIORITY_INVERSION
 350:Lib/libcanard/drivers/stm32/canard_stm32.c ****             CANARD_ASSERT(!"CAN PRIO INV");
 351:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
 352:Lib/libcanard/drivers/stm32/canard_stm32.c ****             return 0;
 353:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 354:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 355:Lib/libcanard/drivers/stm32/canard_stm32.c ****     else                                                // All TX mailboxes are free, use first
 356:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 357:Lib/libcanard/drivers/stm32/canard_stm32.c ****         tx_mailbox = 0;
 358:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 359:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 360:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_ASSERT(tx_mailbox < 3);                      // Index check - the value must be correct 
 779              		.loc 1 360 0
 780 0080 022E     		cmp	r6, #2
 781 0082 2CD8     		bhi	.L83
 782              	.LVL81:
 783              	.L68:
 361:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 362:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 363:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * By this time we've proved that a priority inversion would not occur, and we've also found a 
 364:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Therefore it is safe to enqueue the frame now.
 365:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 366:Lib/libcanard/drivers/stm32/canard_stm32.c ****     volatile CanardSTM32TxMailboxType* const mb = &BXCAN->TxMailbox[tx_mailbox];
 784              		.loc 1 366 0
 785 0084 3501     		lsls	r5, r6, #4
 786 0086 05F18045 		add	r5, r5, #1073741824
 787 008a 05F5CB45 		add	r5, r5, #25984
 788              	.LVL82:
 367:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 368:Lib/libcanard/drivers/stm32/canard_stm32.c ****     mb->TDTR = frame->data_len;                         // DLC equals data length except in CAN FD
 789              		.loc 1 368 0
 790 008e 237B     		ldrb	r3, [r4, #12]	@ zero_extendqisi2
 791 0090 6B60     		str	r3, [r5, #4]
 369:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 370:Lib/libcanard/drivers/stm32/canard_stm32.c ****     mb->TDHR = (((uint32_t)frame->data[7]) << 24U) |
 792              		.loc 1 370 0
 793 0092 E27A     		ldrb	r2, [r4, #11]	@ zero_extendqisi2
 371:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[6]) << 16U) |
 794              		.loc 1 371 0
 795 0094 A37A     		ldrb	r3, [r4, #10]	@ zero_extendqisi2
 796 0096 1B04     		lsls	r3, r3, #16
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 22


 370:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[6]) << 16U) |
 797              		.loc 1 370 0
 798 0098 43EA0263 		orr	r3, r3, r2, lsl #24
 372:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[5]) <<  8U) |
 799              		.loc 1 372 0
 800 009c 627A     		ldrb	r2, [r4, #9]	@ zero_extendqisi2
 371:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[6]) << 16U) |
 801              		.loc 1 371 0
 802 009e 43EA0223 		orr	r3, r3, r2, lsl #8
 373:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[4]) <<  0U);
 803              		.loc 1 373 0
 804 00a2 227A     		ldrb	r2, [r4, #8]	@ zero_extendqisi2
 372:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[5]) <<  8U) |
 805              		.loc 1 372 0
 806 00a4 1343     		orrs	r3, r3, r2
 370:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[6]) << 16U) |
 807              		.loc 1 370 0
 808 00a6 EB60     		str	r3, [r5, #12]
 374:Lib/libcanard/drivers/stm32/canard_stm32.c ****     mb->TDLR = (((uint32_t)frame->data[3]) << 24U) |
 809              		.loc 1 374 0
 810 00a8 E279     		ldrb	r2, [r4, #7]	@ zero_extendqisi2
 375:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[2]) << 16U) |
 811              		.loc 1 375 0
 812 00aa A379     		ldrb	r3, [r4, #6]	@ zero_extendqisi2
 813 00ac 1B04     		lsls	r3, r3, #16
 374:Lib/libcanard/drivers/stm32/canard_stm32.c ****     mb->TDLR = (((uint32_t)frame->data[3]) << 24U) |
 814              		.loc 1 374 0
 815 00ae 43EA0263 		orr	r3, r3, r2, lsl #24
 376:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[1]) <<  8U) |
 816              		.loc 1 376 0
 817 00b2 6279     		ldrb	r2, [r4, #5]	@ zero_extendqisi2
 375:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[2]) << 16U) |
 818              		.loc 1 375 0
 819 00b4 43EA0223 		orr	r3, r3, r2, lsl #8
 377:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[0]) <<  0U);
 820              		.loc 1 377 0
 821 00b8 2279     		ldrb	r2, [r4, #4]	@ zero_extendqisi2
 376:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[1]) <<  8U) |
 822              		.loc 1 376 0
 823 00ba 1343     		orrs	r3, r3, r2
 374:Lib/libcanard/drivers/stm32/canard_stm32.c ****                (((uint32_t)frame->data[2]) << 16U) |
 824              		.loc 1 374 0
 825 00bc AB60     		str	r3, [r5, #8]
 378:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 379:Lib/libcanard/drivers/stm32/canard_stm32.c ****     mb->TIR = convertFrameIDCanardToRegister(frame->id) | CANARD_STM32_CAN_TIR_TXRQ;    // Go.
 826              		.loc 1 379 0
 827 00be 2068     		ldr	r0, [r4]
 828 00c0 FFF7FEFF 		bl	convertFrameIDCanardToRegister
 829              	.LVL83:
 830 00c4 40F00100 		orr	r0, r0, #1
 831 00c8 2860     		str	r0, [r5]
 380:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 381:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 382:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * The frame is now enqueued and pending transmission.
 383:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 384:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return 1;
 832              		.loc 1 384 0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 23


 833 00ca 0120     		movs	r0, #1
 834              	.LVL84:
 835              	.L67:
 385:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 836              		.loc 1 385 0
 837 00cc 02B0     		add	sp, sp, #8
 838              	.LCFI10:
 839              		.cfi_remember_state
 840              		.cfi_def_cfa_offset 16
 841              		@ sp needed
 842 00ce 70BD     		pop	{r4, r5, r6, pc}
 843              	.LVL85:
 844              	.L82:
 845              	.LCFI11:
 846              		.cfi_restore_state
 847              	.LBB16:
 350:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
 848              		.loc 1 350 0
 849 00d0 0B4B     		ldr	r3, .L84+4
 850 00d2 0C4A     		ldr	r2, .L84+8
 851 00d4 4FF4AF71 		mov	r1, #350
 852 00d8 0B48     		ldr	r0, .L84+12
 853 00da FFF7FEFF 		bl	__assert_func
 854              	.LVL86:
 855              	.L83:
 856              	.LBE16:
 360:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 857              		.loc 1 360 0 discriminator 1
 858 00de 0B4B     		ldr	r3, .L84+16
 859 00e0 084A     		ldr	r2, .L84+8
 860 00e2 4FF4B471 		mov	r1, #360
 861 00e6 0848     		ldr	r0, .L84+12
 862 00e8 FFF7FEFF 		bl	__assert_func
 863              	.LVL87:
 864              	.L75:
 357:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 865              		.loc 1 357 0
 866 00ec 0026     		movs	r6, #0
 867 00ee C9E7     		b	.L68
 868              	.LVL88:
 869              	.L73:
 870              	.LCFI12:
 871              		.cfi_def_cfa_offset 0
 872              		.cfi_restore 4
 873              		.cfi_restore 5
 874              		.cfi_restore 6
 875              		.cfi_restore 14
 286:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 876              		.loc 1 286 0
 877 00f0 6FF00100 		mvn	r0, #1
 878              	.LVL89:
 879              		.loc 1 385 0
 880 00f4 7047     		bx	lr
 881              	.LVL90:
 882              	.L74:
 883              	.LCFI13:
 884              		.cfi_def_cfa_offset 24
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 24


 885              		.cfi_offset 4, -16
 886              		.cfi_offset 5, -12
 887              		.cfi_offset 6, -8
 888              		.cfi_offset 14, -4
 291:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 889              		.loc 1 291 0
 890 00f6 0648     		ldr	r0, .L84+20
 891              	.LVL91:
 892 00f8 E8E7     		b	.L67
 893              	.L85:
 894 00fa 00BF     		.align	2
 895              	.L84:
 896 00fc 00640040 		.word	1073767424
 897 0100 00000000 		.word	.LC3
 898 0104 00000000 		.word	.LANCHOR3
 899 0108 38000000 		.word	.LC1
 900 010c 10000000 		.word	.LC4
 901 0110 15FCFFFF 		.word	-1003
 902              		.cfi_endproc
 903              	.LFE7:
 905              		.section	.text.canardSTM32Receive,"ax",%progbits
 906              		.align	1
 907              		.global	canardSTM32Receive
 908              		.syntax unified
 909              		.thumb
 910              		.thumb_func
 911              		.fpu fpv4-sp-d16
 913              	canardSTM32Receive:
 914              	.LFB8:
 386:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 387:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 388:Lib/libcanard/drivers/stm32/canard_stm32.c **** int16_t canardSTM32Receive(CanardCANFrame* const out_frame)
 389:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 915              		.loc 1 389 0
 916              		.cfi_startproc
 917              		@ args = 0, pretend = 0, frame = 0
 918              		@ frame_needed = 0, uses_anonymous_args = 0
 919              	.LVL92:
 390:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (out_frame == NULL)
 920              		.loc 1 390 0
 921 0000 0028     		cmp	r0, #0
 922 0002 43D0     		beq	.L92
 389:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if (out_frame == NULL)
 923              		.loc 1 389 0
 924 0004 2DE97848 		push	{r3, r4, r5, r6, fp, lr}
 925              	.LCFI14:
 926              		.cfi_def_cfa_offset 24
 927              		.cfi_offset 3, -24
 928              		.cfi_offset 4, -20
 929              		.cfi_offset 5, -16
 930              		.cfi_offset 6, -12
 931              		.cfi_offset 11, -8
 932              		.cfi_offset 14, -4
 933 0008 0546     		mov	r5, r0
 391:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 392:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_ERROR_INVALID_ARGUMENT;
 393:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 25


 394:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 395:Lib/libcanard/drivers/stm32/canard_stm32.c ****     static volatile uint32_t* const RFxR[2] =
 396:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 397:Lib/libcanard/drivers/stm32/canard_stm32.c ****         &BXCAN->RF0R,
 398:Lib/libcanard/drivers/stm32/canard_stm32.c ****         &BXCAN->RF1R
 399:Lib/libcanard/drivers/stm32/canard_stm32.c ****     };
 400:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 401:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 402:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * This function must be polled periodically, so we use this opportunity to do it.
 403:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 404:Lib/libcanard/drivers/stm32/canard_stm32.c ****     processErrorStatus();
 934              		.loc 1 404 0
 935 000a FFF7FEFF 		bl	processErrorStatus
 936              	.LVL93:
 937              	.LBB17:
 405:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 406:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 407:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Reading the TX FIFO
 408:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 409:Lib/libcanard/drivers/stm32/canard_stm32.c ****     for (uint_fast8_t i = 0; i < 2; i++)
 938              		.loc 1 409 0
 939 000e 0023     		movs	r3, #0
 940              	.LVL94:
 941              	.L88:
 942              		.loc 1 409 0 is_stmt 0 discriminator 1
 943 0010 012B     		cmp	r3, #1
 944 0012 38D8     		bhi	.L97
 945              	.LBB18:
 410:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 411:Lib/libcanard/drivers/stm32/canard_stm32.c ****         volatile CanardSTM32RxMailboxType* const mb = &BXCAN->RxMailbox[i];
 946              		.loc 1 411 0 is_stmt 1
 947 0014 1F4C     		ldr	r4, .L99
 948 0016 04EB0314 		add	r4, r4, r3, lsl #4
 949              	.LVL95:
 412:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 413:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (((*RFxR[i]) & CANARD_STM32_CAN_RFR_FMP_MASK) != 0)
 950              		.loc 1 413 0
 951 001a 1F4A     		ldr	r2, .L99+4
 952 001c 52F82360 		ldr	r6, [r2, r3, lsl #2]
 953 0020 3268     		ldr	r2, [r6]
 954 0022 12F0030F 		tst	r2, #3
 955 0026 01D1     		bne	.L98
 956              	.LBE18:
 409:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 957              		.loc 1 409 0 discriminator 2
 958 0028 0133     		adds	r3, r3, #1
 959              	.LVL96:
 960 002a F1E7     		b	.L88
 961              	.L98:
 962              	.LBB20:
 963              	.LBB19:
 414:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 415:Lib/libcanard/drivers/stm32/canard_stm32.c ****             if (*RFxR[i] & CANARD_STM32_CAN_RFR_FOVR)
 964              		.loc 1 415 0
 965 002c 3368     		ldr	r3, [r6]
 966              	.LVL97:
 967 002e 13F0100F 		tst	r3, #16
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 26


 968 0032 08D0     		beq	.L90
 416:Lib/libcanard/drivers/stm32/canard_stm32.c ****             {
 417:Lib/libcanard/drivers/stm32/canard_stm32.c ****                 g_stats.rx_overflow_count++;
 969              		.loc 1 417 0
 970 0034 1949     		ldr	r1, .L99+8
 971 0036 D1E900BC 		ldrd	fp, [r1]
 972 003a 1BF10102 		adds	r2, fp, #1
 973 003e 4CF10003 		adc	r3, ip, #0
 974 0042 C1E90023 		strd	r2, [r1]
 975              	.L90:
 418:Lib/libcanard/drivers/stm32/canard_stm32.c ****             }
 419:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 420:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->id = convertFrameIDRegisterToCanard(mb->RIR);
 976              		.loc 1 420 0
 977 0046 2068     		ldr	r0, [r4]
 978 0048 FFF7FEFF 		bl	convertFrameIDRegisterToCanard
 979              	.LVL98:
 980 004c 2860     		str	r0, [r5]
 421:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 422:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data_len = (uint8_t)(mb->RDTR & CANARD_STM32_CAN_RDTR_DLC_MASK);
 981              		.loc 1 422 0
 982 004e 6368     		ldr	r3, [r4, #4]
 983 0050 03F00F03 		and	r3, r3, #15
 984 0054 2B73     		strb	r3, [r5, #12]
 423:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 424:Lib/libcanard/drivers/stm32/canard_stm32.c ****             // Caching to regular (non volatile) memory for faster reads
 425:Lib/libcanard/drivers/stm32/canard_stm32.c ****             const uint32_t rdlr = mb->RDLR;
 985              		.loc 1 425 0
 986 0056 A268     		ldr	r2, [r4, #8]
 987              	.LVL99:
 426:Lib/libcanard/drivers/stm32/canard_stm32.c ****             const uint32_t rdhr = mb->RDHR;
 988              		.loc 1 426 0
 989 0058 E368     		ldr	r3, [r4, #12]
 990              	.LVL100:
 427:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 428:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[0] = (uint8_t)(0xFFU & (rdlr >>  0U));
 991              		.loc 1 428 0
 992 005a 2A71     		strb	r2, [r5, #4]
 429:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[1] = (uint8_t)(0xFFU & (rdlr >>  8U));
 993              		.loc 1 429 0
 994 005c C2F30721 		ubfx	r1, r2, #8, #8
 995 0060 6971     		strb	r1, [r5, #5]
 430:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[2] = (uint8_t)(0xFFU & (rdlr >> 16U));
 996              		.loc 1 430 0
 997 0062 C2F30741 		ubfx	r1, r2, #16, #8
 998 0066 A971     		strb	r1, [r5, #6]
 431:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[3] = (uint8_t)(0xFFU & (rdlr >> 24U));
 999              		.loc 1 431 0
 1000 0068 120E     		lsrs	r2, r2, #24
 1001              	.LVL101:
 1002 006a EA71     		strb	r2, [r5, #7]
 432:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[4] = (uint8_t)(0xFFU & (rdhr >>  0U));
 1003              		.loc 1 432 0
 1004 006c 2B72     		strb	r3, [r5, #8]
 433:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[5] = (uint8_t)(0xFFU & (rdhr >>  8U));
 1005              		.loc 1 433 0
 1006 006e C3F30722 		ubfx	r2, r3, #8, #8
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 27


 1007 0072 6A72     		strb	r2, [r5, #9]
 434:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[6] = (uint8_t)(0xFFU & (rdhr >> 16U));
 1008              		.loc 1 434 0
 1009 0074 C3F30742 		ubfx	r2, r3, #16, #8
 1010 0078 AA72     		strb	r2, [r5, #10]
 435:Lib/libcanard/drivers/stm32/canard_stm32.c ****             out_frame->data[7] = (uint8_t)(0xFFU & (rdhr >> 24U));
 1011              		.loc 1 435 0
 1012 007a 1B0E     		lsrs	r3, r3, #24
 1013              	.LVL102:
 1014 007c EB72     		strb	r3, [r5, #11]
 436:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 437:Lib/libcanard/drivers/stm32/canard_stm32.c ****             // Release FIFO entry we just read
 438:Lib/libcanard/drivers/stm32/canard_stm32.c ****             *RFxR[i] = CANARD_STM32_CAN_RFR_RFOM | CANARD_STM32_CAN_RFR_FOVR | CANARD_STM32_CAN_RFR
 1015              		.loc 1 438 0
 1016 007e 3823     		movs	r3, #56
 1017 0080 3360     		str	r3, [r6]
 439:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 440:Lib/libcanard/drivers/stm32/canard_stm32.c ****             // Reading successful
 441:Lib/libcanard/drivers/stm32/canard_stm32.c ****             return 1;
 1018              		.loc 1 441 0
 1019 0082 0120     		movs	r0, #1
 1020 0084 00E0     		b	.L87
 1021              	.LVL103:
 1022              	.L97:
 1023              	.LBE19:
 1024              	.LBE20:
 1025              	.LBE17:
 442:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 443:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 444:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 445:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // No frames to read
 446:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return 0;
 1026              		.loc 1 446 0
 1027 0086 0020     		movs	r0, #0
 1028              	.LVL104:
 1029              	.L87:
 447:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 1030              		.loc 1 447 0
 1031 0088 BDE87888 		pop	{r3, r4, r5, r6, fp, pc}
 1032              	.LVL105:
 1033              	.L92:
 1034              	.LCFI15:
 1035              		.cfi_def_cfa_offset 0
 1036              		.cfi_restore 3
 1037              		.cfi_restore 4
 1038              		.cfi_restore 5
 1039              		.cfi_restore 6
 1040              		.cfi_restore 11
 1041              		.cfi_restore 14
 392:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 1042              		.loc 1 392 0
 1043 008c 6FF00100 		mvn	r0, #1
 1044              	.LVL106:
 1045              		.loc 1 447 0
 1046 0090 7047     		bx	lr
 1047              	.L100:
 1048 0092 00BF     		.align	2
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 28


 1049              	.L99:
 1050 0094 B0650040 		.word	1073767856
 1051 0098 00000000 		.word	.LANCHOR4
 1052 009c 00000000 		.word	.LANCHOR0
 1053              		.cfi_endproc
 1054              	.LFE8:
 1056              		.section	.text.canardSTM32ConfigureAcceptanceFilters,"ax",%progbits
 1057              		.align	1
 1058              		.global	canardSTM32ConfigureAcceptanceFilters
 1059              		.syntax unified
 1060              		.thumb
 1061              		.thumb_func
 1062              		.fpu fpv4-sp-d16
 1064              	canardSTM32ConfigureAcceptanceFilters:
 1065              	.LFB9:
 448:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 449:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 450:Lib/libcanard/drivers/stm32/canard_stm32.c **** int16_t canardSTM32ConfigureAcceptanceFilters(const CanardSTM32AcceptanceFilterConfiguration* const
 451:Lib/libcanard/drivers/stm32/canard_stm32.c ****                                               const uint8_t num_filter_configs)
 452:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 1066              		.loc 1 452 0
 1067              		.cfi_startproc
 1068              		@ args = 0, pretend = 0, frame = 0
 1069              		@ frame_needed = 0, uses_anonymous_args = 0
 1070              		@ link register save eliminated.
 1071              	.LVL107:
 453:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // Note that num_filter_configs = 0 is a valid configuration, which rejects all frames.
 454:Lib/libcanard/drivers/stm32/canard_stm32.c ****     if ((filter_configs == NULL) ||
 1072              		.loc 1 454 0
 1073 0000 0028     		cmp	r0, #0
 1074 0002 3FD0     		beq	.L111
 452:Lib/libcanard/drivers/stm32/canard_stm32.c ****     // Note that num_filter_configs = 0 is a valid configuration, which rejects all frames.
 1075              		.loc 1 452 0 discriminator 1
 1076 0004 70B4     		push	{r4, r5, r6}
 1077              	.LCFI16:
 1078              		.cfi_def_cfa_offset 12
 1079              		.cfi_offset 4, -12
 1080              		.cfi_offset 5, -8
 1081              		.cfi_offset 6, -4
 1082 0006 0646     		mov	r6, r0
 1083              		.loc 1 454 0 discriminator 1
 1084 0008 0E29     		cmp	r1, #14
 1085 000a 3ED8     		bhi	.L112
 455:Lib/libcanard/drivers/stm32/canard_stm32.c ****         (num_filter_configs > CANARD_STM32_NUM_ACCEPTANCE_FILTERS))
 456:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 457:Lib/libcanard/drivers/stm32/canard_stm32.c ****         return -CANARD_ERROR_INVALID_ARGUMENT;
 458:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 459:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 460:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 461:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * First we disable all filters. This may cause momentary RX frame losses, but the application
 462:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * should be able to tolerate that.
 463:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 464:Lib/libcanard/drivers/stm32/canard_stm32.c ****     CANARD_STM32_CAN1->FA1R = 0;
 1086              		.loc 1 464 0
 1087 000c 0023     		movs	r3, #0
 1088 000e 204A     		ldr	r2, .L119
 1089 0010 C2F81C32 		str	r3, [r2, #540]
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 29


 1090              	.LVL108:
 1091              	.LBB21:
 465:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 466:Lib/libcanard/drivers/stm32/canard_stm32.c ****     /*
 467:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Having filters disabled we can update the configuration.
 468:Lib/libcanard/drivers/stm32/canard_stm32.c ****      * Register mapping: FR1 - ID, FR2 - Mask
 469:Lib/libcanard/drivers/stm32/canard_stm32.c ****      */
 470:Lib/libcanard/drivers/stm32/canard_stm32.c ****     for (uint8_t i = 0; i < num_filter_configs; i++)
 1092              		.loc 1 470 0
 1093 0014 22E0     		b	.L103
 1094              	.LVL109:
 1095              	.L104:
 1096              	.LBB22:
 471:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 472:Lib/libcanard/drivers/stm32/canard_stm32.c ****         /*
 473:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * Converting the ID and the Mask into the representation that can be chewed by the hardwar
 474:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * If Mask asks us to accept both STDID and EXTID, we need to use EXT mode on the filter,
 475:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * otherwise it will reject all EXTID frames. This logic is not documented in the RM.
 476:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 477:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * The logic of the hardware acceptance filters can be described as follows:
 478:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 479:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  accepted = (received_id & filter_mask) == (filter_id & filter_mask)
 480:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 481:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * Where:
 482:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - accepted      - if true, the frame will be accepted by the filter.
 483:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - received_id   - the CAN ID of the received frame, either 11-bit or 29-bit, with exten
 484:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *                    marking extended frames, error frames, etc.
 485:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - filter_id     - the value of the filter ID register.
 486:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - filter_mask   - the value of the filter mask register.
 487:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 488:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * There are special bits that are not members of the CAN ID field:
 489:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - EFF - set for extended frames (29-bit), cleared for standard frames (11-bit)
 490:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  - RTR - like above, indicates Remote Transmission Request frames.
 491:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 492:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * The following truth table summarizes the logic (where: FM - filter mask, FID - filter ID
 493:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * frame ID, A - true if accepted, X - any state):
 494:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 495:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  FM  FID RID A
 496:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  0   X   X   1
 497:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   0   0   1
 498:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   1   0   0
 499:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   0   1   0
 500:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   1   1   1
 501:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 502:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * One would expect that for the purposes of hardware filtering, the special bits should be
 503:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * in the same way as the real ID bits. However, this is not the case with bxCAN. The follo
 504:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * table has been determined empirically (this behavior was not documented as of 2017):
 505:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *
 506:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  FM  FID RID A
 507:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  0   0   0   1
 508:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  0   0   1   0       <-- frame rejected!
 509:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  0   1   X   1
 510:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   0   0   1
 511:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   1   0   0
 512:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   0   1   0
 513:Lib/libcanard/drivers/stm32/canard_stm32.c ****          *  1   1   1   1
 514:Lib/libcanard/drivers/stm32/canard_stm32.c ****          */
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 30


 515:Lib/libcanard/drivers/stm32/canard_stm32.c ****         uint32_t id   = 0;
 516:Lib/libcanard/drivers/stm32/canard_stm32.c ****         uint32_t mask = 0;
 517:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 518:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const CanardSTM32AcceptanceFilterConfiguration* const cfg = filter_configs + i;
 519:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 520:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if ((cfg->id & CANARD_CAN_FRAME_EFF) || !(cfg->mask & CANARD_CAN_FRAME_EFF))
 521:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 522:Lib/libcanard/drivers/stm32/canard_stm32.c ****             id   = (cfg->id   & CANARD_CAN_EXT_ID_MASK) << 3U;
 1097              		.loc 1 522 0
 1098 0016 E000     		lsls	r0, r4, #3
 1099              	.LVL110:
 523:Lib/libcanard/drivers/stm32/canard_stm32.c ****             mask = (cfg->mask & CANARD_CAN_EXT_ID_MASK) << 3U;
 1100              		.loc 1 523 0
 1101 0018 6A68     		ldr	r2, [r5, #4]
 1102 001a D200     		lsls	r2, r2, #3
 1103              	.LVL111:
 524:Lib/libcanard/drivers/stm32/canard_stm32.c ****             id |= CANARD_STM32_CAN_RIR_IDE;
 1104              		.loc 1 524 0
 1105 001c 40F00400 		orr	r0, r0, #4
 1106              	.LVL112:
 1107              	.L106:
 525:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 526:Lib/libcanard/drivers/stm32/canard_stm32.c ****         else
 527:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 528:Lib/libcanard/drivers/stm32/canard_stm32.c ****             id   = (cfg->id   & CANARD_CAN_STD_ID_MASK) << 21U;
 529:Lib/libcanard/drivers/stm32/canard_stm32.c ****             mask = (cfg->mask & CANARD_CAN_STD_ID_MASK) << 21U;
 530:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 531:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 532:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (cfg->id & CANARD_CAN_FRAME_RTR)
 1108              		.loc 1 532 0
 1109 0020 14F0804F 		tst	r4, #1073741824
 1110 0024 01D0     		beq	.L107
 533:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 534:Lib/libcanard/drivers/stm32/canard_stm32.c ****             id |= CANARD_STM32_CAN_RIR_RTR;
 1111              		.loc 1 534 0
 1112 0026 40F00200 		orr	r0, r0, #2
 1113              	.LVL113:
 1114              	.L107:
 535:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 536:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 537:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (cfg->mask & CANARD_CAN_FRAME_EFF)
 1115              		.loc 1 537 0
 1116 002a 6C68     		ldr	r4, [r5, #4]
 1117 002c 002C     		cmp	r4, #0
 1118 002e 23DB     		blt	.L117
 1119              	.L108:
 538:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 539:Lib/libcanard/drivers/stm32/canard_stm32.c ****             mask |= CANARD_STM32_CAN_RIR_IDE;
 540:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 541:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 542:Lib/libcanard/drivers/stm32/canard_stm32.c ****         if (cfg->mask & CANARD_CAN_FRAME_RTR)
 1120              		.loc 1 542 0
 1121 0030 14F0804F 		tst	r4, #1073741824
 1122 0034 01D0     		beq	.L109
 543:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 544:Lib/libcanard/drivers/stm32/canard_stm32.c ****             mask |= CANARD_STM32_CAN_RIR_RTR;
 1123              		.loc 1 544 0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 31


 1124 0036 42F00202 		orr	r2, r2, #2
 1125              	.LVL114:
 1126              	.L109:
 545:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 546:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 547:Lib/libcanard/drivers/stm32/canard_stm32.c ****         /*
 548:Lib/libcanard/drivers/stm32/canard_stm32.c ****          * Applying the converted representation to the registers.
 549:Lib/libcanard/drivers/stm32/canard_stm32.c ****          */
 550:Lib/libcanard/drivers/stm32/canard_stm32.c ****         const uint8_t filter_index =
 551:Lib/libcanard/drivers/stm32/canard_stm32.c **** #if CANARD_STM32_USE_CAN2
 552:Lib/libcanard/drivers/stm32/canard_stm32.c ****             (uint8_t)(i + CANARD_STM32_NUM_ACCEPTANCE_FILTERS);
 553:Lib/libcanard/drivers/stm32/canard_stm32.c **** #else
 554:Lib/libcanard/drivers/stm32/canard_stm32.c ****             i;
 555:Lib/libcanard/drivers/stm32/canard_stm32.c **** #endif
 556:Lib/libcanard/drivers/stm32/canard_stm32.c ****         CANARD_STM32_CAN1->FilterRegister[filter_index].FR1 = id;
 1127              		.loc 1 556 0 discriminator 2
 1128 003a 154C     		ldr	r4, .L119
 1129 003c 03F14805 		add	r5, r3, #72
 1130              	.LVL115:
 1131 0040 44F83500 		str	r0, [r4, r5, lsl #3]
 557:Lib/libcanard/drivers/stm32/canard_stm32.c ****         CANARD_STM32_CAN1->FilterRegister[filter_index].FR2 = mask;
 1132              		.loc 1 557 0 discriminator 2
 1133 0044 04EBC505 		add	r5, r4, r5, lsl #3
 1134 0048 6A60     		str	r2, [r5, #4]
 558:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 559:Lib/libcanard/drivers/stm32/canard_stm32.c ****         CANARD_STM32_CAN1->FA1R |= 1U << filter_index;      // Enable
 1135              		.loc 1 559 0 discriminator 2
 1136 004a D4F81C22 		ldr	r2, [r4, #540]
 1137              	.LVL116:
 1138 004e 0120     		movs	r0, #1
 1139              	.LVL117:
 1140 0050 9840     		lsls	r0, r0, r3
 1141 0052 0243     		orrs	r2, r2, r0
 1142 0054 C4F81C22 		str	r2, [r4, #540]
 1143              	.LVL118:
 1144              	.LBE22:
 470:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 1145              		.loc 1 470 0 discriminator 2
 1146 0058 0133     		adds	r3, r3, #1
 1147              	.LVL119:
 1148 005a DBB2     		uxtb	r3, r3
 1149              	.LVL120:
 1150              	.L103:
 470:Lib/libcanard/drivers/stm32/canard_stm32.c ****     {
 1151              		.loc 1 470 0 is_stmt 0 discriminator 1
 1152 005c 8B42     		cmp	r3, r1
 1153 005e 0ED2     		bcs	.L118
 1154              	.LVL121:
 1155              	.LBB23:
 518:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 1156              		.loc 1 518 0 is_stmt 1
 1157 0060 06EBC305 		add	r5, r6, r3, lsl #3
 1158              	.LVL122:
 520:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 1159              		.loc 1 520 0
 1160 0064 56F83340 		ldr	r4, [r6, r3, lsl #3]
 1161 0068 002C     		cmp	r4, #0
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 32


 1162 006a D4DB     		blt	.L104
 520:Lib/libcanard/drivers/stm32/canard_stm32.c ****         {
 1163              		.loc 1 520 0 is_stmt 0 discriminator 1
 1164 006c 6A68     		ldr	r2, [r5, #4]
 1165 006e 002A     		cmp	r2, #0
 1166 0070 D1DA     		bge	.L104
 528:Lib/libcanard/drivers/stm32/canard_stm32.c ****             mask = (cfg->mask & CANARD_CAN_STD_ID_MASK) << 21U;
 1167              		.loc 1 528 0 is_stmt 1
 1168 0072 6005     		lsls	r0, r4, #21
 1169              	.LVL123:
 529:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 1170              		.loc 1 529 0
 1171 0074 5205     		lsls	r2, r2, #21
 1172              	.LVL124:
 1173 0076 D3E7     		b	.L106
 1174              	.L117:
 539:Lib/libcanard/drivers/stm32/canard_stm32.c ****         }
 1175              		.loc 1 539 0
 1176 0078 42F00402 		orr	r2, r2, #4
 1177              	.LVL125:
 1178 007c D8E7     		b	.L108
 1179              	.LVL126:
 1180              	.L118:
 1181              	.LBE23:
 1182              	.LBE21:
 560:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 561:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 562:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return 0;
 1183              		.loc 1 562 0
 1184 007e 0020     		movs	r0, #0
 1185              	.LVL127:
 1186              	.L102:
 563:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 1187              		.loc 1 563 0
 1188 0080 70BC     		pop	{r4, r5, r6}
 1189              	.LCFI17:
 1190              		.cfi_restore 6
 1191              		.cfi_restore 5
 1192              		.cfi_restore 4
 1193              		.cfi_def_cfa_offset 0
 1194              	.LVL128:
 1195 0082 7047     		bx	lr
 1196              	.LVL129:
 1197              	.L111:
 457:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 1198              		.loc 1 457 0
 1199 0084 6FF00100 		mvn	r0, #1
 1200              	.LVL130:
 1201              		.loc 1 563 0
 1202 0088 7047     		bx	lr
 1203              	.LVL131:
 1204              	.L112:
 1205              	.LCFI18:
 1206              		.cfi_def_cfa_offset 12
 1207              		.cfi_offset 4, -12
 1208              		.cfi_offset 5, -8
 1209              		.cfi_offset 6, -4
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 33


 457:Lib/libcanard/drivers/stm32/canard_stm32.c ****     }
 1210              		.loc 1 457 0
 1211 008a 6FF00100 		mvn	r0, #1
 1212              	.LVL132:
 1213 008e F7E7     		b	.L102
 1214              	.L120:
 1215              		.align	2
 1216              	.L119:
 1217 0090 00640040 		.word	1073767424
 1218              		.cfi_endproc
 1219              	.LFE9:
 1221              		.section	.text.canardSTM32GetStats,"ax",%progbits
 1222              		.align	1
 1223              		.global	canardSTM32GetStats
 1224              		.syntax unified
 1225              		.thumb
 1226              		.thumb_func
 1227              		.fpu fpv4-sp-d16
 1229              	canardSTM32GetStats:
 1230              	.LFB10:
 564:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 565:Lib/libcanard/drivers/stm32/canard_stm32.c **** 
 566:Lib/libcanard/drivers/stm32/canard_stm32.c **** CanardSTM32Stats canardSTM32GetStats(void)
 567:Lib/libcanard/drivers/stm32/canard_stm32.c **** {
 1231              		.loc 1 567 0
 1232              		.cfi_startproc
 1233              		@ args = 0, pretend = 0, frame = 0
 1234              		@ frame_needed = 0, uses_anonymous_args = 0
 1235              		@ link register save eliminated.
 1236              	.LVL133:
 1237 0000 10B4     		push	{r4}
 1238              	.LCFI19:
 1239              		.cfi_def_cfa_offset 4
 1240              		.cfi_offset 4, -4
 1241 0002 0446     		mov	r4, r0
 568:Lib/libcanard/drivers/stm32/canard_stm32.c ****     return g_stats;
 1242              		.loc 1 568 0
 1243 0004 034B     		ldr	r3, .L123
 1244 0006 0FCB     		ldm	r3, {r0, r1, r2, r3}
 1245              	.LVL134:
 1246 0008 84E80F00 		stm	r4, {r0, r1, r2, r3}
 569:Lib/libcanard/drivers/stm32/canard_stm32.c **** }
 1247              		.loc 1 569 0
 1248 000c 2046     		mov	r0, r4
 1249 000e 5DF8044B 		ldr	r4, [sp], #4
 1250              	.LCFI20:
 1251              		.cfi_restore 4
 1252              		.cfi_def_cfa_offset 0
 1253              	.LVL135:
 1254 0012 7047     		bx	lr
 1255              	.L124:
 1256              		.align	2
 1257              	.L123:
 1258 0014 00000000 		.word	.LANCHOR0
 1259              		.cfi_endproc
 1260              	.LFE10:
 1262              		.section	.bss.g_abort_tx_on_error,"aw",%nobits
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 34


 1263              		.set	.LANCHOR1,. + 0
 1266              	g_abort_tx_on_error:
 1267 0000 00       		.space	1
 1268              		.section	.bss.g_stats,"aw",%nobits
 1269              		.align	3
 1270              		.set	.LANCHOR0,. + 0
 1273              	g_stats:
 1274 0000 00000000 		.space	16
 1274      00000000 
 1274      00000000 
 1274      00000000 
 1275              		.section	.rodata.RFxR.6536,"a",%progbits
 1276              		.align	2
 1277              		.set	.LANCHOR4,. + 0
 1280              	RFxR.6536:
 1281 0000 0C640040 		.word	1073767436
 1282 0004 10640040 		.word	1073767440
 1283              		.section	.rodata.__func__.6519,"a",%progbits
 1284              		.align	2
 1285              		.set	.LANCHOR2,. + 0
 1288              	__func__.6519:
 1289 0000 63616E61 		.ascii	"canardSTM32Init\000"
 1289      72645354 
 1289      4D333249 
 1289      6E697400 
 1290              		.section	.rodata.__func__.6531,"a",%progbits
 1291              		.align	2
 1292              		.set	.LANCHOR3,. + 0
 1295              	__func__.6531:
 1296 0000 63616E61 		.ascii	"canardSTM32Transmit\000"
 1296      72645354 
 1296      4D333254 
 1296      72616E73 
 1296      6D697400 
 1297              		.section	.rodata.canardSTM32Init.str1.4,"aMS",%progbits,1
 1298              		.align	2
 1299              	.LC0:
 1300 0000 30203D3D 		.ascii	"0 == ((volatile CanardSTM32CANType*)0x40006400U)->I"
 1300      20282876 
 1300      6F6C6174 
 1300      696C6520 
 1300      43616E61 
 1301 0033 455200   		.ascii	"ER\000"
 1302 0036 0000     		.space	2
 1303              	.LC1:
 1304 0038 4C69622F 		.ascii	"Lib/libcanard/drivers/stm32/canard_stm32.c\000"
 1304      6C696263 
 1304      616E6172 
 1304      642F6472 
 1304      69766572 
 1305 0063 00       		.space	1
 1306              	.LC2:
 1307 0064 28282828 		.ascii	"((((volatile CanardSTM32CANType*)0x40006400U)->FMR "
 1307      766F6C61 
 1307      74696C65 
 1307      2043616E 
 1307      61726453 
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 35


 1308 0097 3E3E2038 		.ascii	">> 8U) & 0x3FU) == 14U\000"
 1308      55292026 
 1308      20307833 
 1308      46552920 
 1308      3D3D2031 
 1309              		.section	.rodata.canardSTM32Transmit.str1.4,"aMS",%progbits,1
 1310              		.align	2
 1311              	.LC3:
 1312 0000 21224341 		.ascii	"!\"CAN PRIO INV\"\000"
 1312      4E205052 
 1312      494F2049 
 1312      4E562200 
 1313              	.LC4:
 1314 0010 74785F6D 		.ascii	"tx_mailbox < 3\000"
 1314      61696C62 
 1314      6F78203C 
 1314      203300
 1315              		.text
 1316              	.Letext0:
 1317              		.file 2 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/machine/_d
 1318              		.file 3 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/sys/_stdin
 1319              		.file 4 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/stdint.h"
 1320              		.file 5 "Lib/libcanard/canard.h"
 1321              		.file 6 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/sys/lock.h
 1322              		.file 7 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/sys/_types
 1323              		.file 8 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/lib/gcc/arm-none-eabi/7.3.1/incl
 1324              		.file 9 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/sys/reent.
 1325              		.file 10 "Lib/libcanard/drivers/stm32/canard_stm32.h"
 1326              		.file 11 "Lib/libcanard/drivers/stm32/_internal_bxcan.h"
 1327              		.file 12 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/sys/unist
 1328              		.file 13 "/usr/local/Cellar/arm-none-eabi-gcc/7-2018-q2-update/gcc/arm-none-eabi/include/assert.h"
ARM GAS  /var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s 			page 36


DEFINED SYMBOLS
                            *ABS*:0000000000000000 canard_stm32.c
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:18     .text.isFramePriorityHigher:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:24     .text.isFramePriorityHigher:0000000000000000 isFramePriorityHigher
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:125    .text.convertFrameIDCanardToRegister:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:131    .text.convertFrameIDCanardToRegister:0000000000000000 convertFrameIDCanardToRegister
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:166    .text.convertFrameIDRegisterToCanard:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:172    .text.convertFrameIDRegisterToCanard:0000000000000000 convertFrameIDRegisterToCanard
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:209    .text.waitMSRINAKBitStateChange:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:215    .text.waitMSRINAKBitStateChange:0000000000000000 waitMSRINAKBitStateChange
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:286    .text.processErrorStatus:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:292    .text.processErrorStatus:0000000000000000 processErrorStatus
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:349    .text.processErrorStatus:0000000000000044 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:357    .text.canardSTM32Init:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:364    .text.canardSTM32Init:0000000000000000 canardSTM32Init
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:655    .text.canardSTM32Init:00000000000001a8 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:667    .text.canardSTM32Transmit:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:674    .text.canardSTM32Transmit:0000000000000000 canardSTM32Transmit
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:896    .text.canardSTM32Transmit:00000000000000fc $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:906    .text.canardSTM32Receive:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:913    .text.canardSTM32Receive:0000000000000000 canardSTM32Receive
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1050   .text.canardSTM32Receive:0000000000000094 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1057   .text.canardSTM32ConfigureAcceptanceFilters:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1064   .text.canardSTM32ConfigureAcceptanceFilters:0000000000000000 canardSTM32ConfigureAcceptanceFilters
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1217   .text.canardSTM32ConfigureAcceptanceFilters:0000000000000090 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1222   .text.canardSTM32GetStats:0000000000000000 $t
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1229   .text.canardSTM32GetStats:0000000000000000 canardSTM32GetStats
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1258   .text.canardSTM32GetStats:0000000000000014 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1266   .bss.g_abort_tx_on_error:0000000000000000 g_abort_tx_on_error
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1267   .bss.g_abort_tx_on_error:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1269   .bss.g_stats:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1273   .bss.g_stats:0000000000000000 g_stats
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1276   .rodata.RFxR.6536:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1280   .rodata.RFxR.6536:0000000000000000 RFxR.6536
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1284   .rodata.__func__.6519:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1288   .rodata.__func__.6519:0000000000000000 __func__.6519
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1291   .rodata.__func__.6531:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1295   .rodata.__func__.6531:0000000000000000 __func__.6531
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1298   .rodata.canardSTM32Init.str1.4:0000000000000000 $d
/var/folders/pr/jy5_dyq97qq9ykqb3p58dhg00000gn/T//cciZoqId.s:1310   .rodata.canardSTM32Transmit.str1.4:0000000000000000 $d

UNDEFINED SYMBOLS
__assert_func
